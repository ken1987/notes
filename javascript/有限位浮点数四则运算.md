#有限位浮点数四则运算
项目中遇到js浮点运算导致的精度丢失问题，网上大多通过乘法补位成为整数后再进行运算，但是今天项目中发现乘法也会丢失精度，例如4481.9x100，所以通过之前的方法不能有效的解决这个问题，于是考虑通过操作字符串的方式来解决，通过几次修改有以下版本。

 * 只支持有限位浮点数，如果浮点数过大，会导致数值转换int时位数过大溢出
 * 只支持简单的四则运算，例如：'0.1+0.2' 和 '4481.9 * 100'


```javascript
var operation = (function() {
    /**
     * 获取小数位长度
     * @param  {string}  n   字符串型数值
     * @return {number}  小数位长度
     */
    var getDigit = function(n) {
        n = n.split(".")[1];
        return n ? n.length : 0;
    };

    /**
     * 转换成整数
     * @param  {string} n     字符串型数值
     * @param  {number} digit 位数
     * @return {number} 数值
     */
    var parser2Int = function(n, digit) {
        return n.replace(/\.(.*)/, function(str, _1) {
            var len = _1.length;
            return len ? _1 * Math.pow(10, digit - len) : '';
        });
    };

    /**
     * 计算函数
     * @param  {string} expression 简单的四则运算表达式
     * @return {number} 运算结果
     */
    return function(expression) {
        var operator, //操作符
            n1, //被操作数
            n2; //操作数

        //只匹配一次
        expression.replace(/([\d\.]+)\s?([+\-\*\/])\s?([\d\.]+)/, function(str, _1, _2, _3) {
            n1 = _1;
            operator = _2;
            n2 = _3;
        });

        if (!isNaN(n1) && !isNaN(n2) && operator) {
            var d1 = getDigit(n1);
            var d2 = getDigit(n2);

            //加法和减法
            if (operator == '+' || operator == '-') {
                d1 = d1 > d2 ? d1 : d2; //最大的小数位
                n1 = parser2Int(n1, d1);
                n2 = parser2Int(n2, d1);

                if (operator == '+') {
                    n2 = -n2; //加号被当作是字符串连接符，转换成减法，隐式类型转换
                }
                return (n1 - n2) / Math.pow(10, d1);
            } else {
                n1 = parser2Int(n1, d1);
                n2 = parser2Int(n2, d2);
                d1 = d1 + d2; //需要被除回来的
                if (operator == '*') {
                    return n1 * n2 / Math.pow(10, d1);
                } else {
                    if (!n2) return NaN; //除数不能为0
                    return n1 / (n2 * Math.pow(10, d1));
                }
            }
        }
        return NaN;
    };
}());
console.log(operation('0.1+0.2'));
console.log(operation('4481.9 * 100'));
```
